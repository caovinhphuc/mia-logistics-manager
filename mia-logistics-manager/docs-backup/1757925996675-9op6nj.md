# MIA Logistics Manager

H·ªá th·ªëng qu·∫£n l√Ω logistics chuy√™n nghi·ªáp v·ªõi ƒë·∫ßy ƒë·ªß t√≠nh nƒÉng qu·∫£n l√Ω v·∫≠n chuy·ªÉn, kho h√†ng, nh√¢n vi√™n v√† ph√¢n quy·ªÅn.

## üöÄ T√≠nh nƒÉng ch√≠nh

### üìä Dashboard & B√°o c√°o

- Dashboard t·ªïng quan v·ªõi c√°c KPI ch√≠nh
- Bi·ªÉu ƒë·ªì th·ªëng k√™ v·∫≠n chuy·ªÉn theo th√°ng
- Ho·∫°t ƒë·ªông g·∫ßn ƒë√¢y

### üöõ Qu·∫£n l√Ω V·∫≠n chuy·ªÉn

- **V·∫≠n chuy·ªÉn (TransportRequestsSheet)**: Giao di·ªán b·∫£ng v√† grid view cho y√™u c·∫ßu v·∫≠n chuy·ªÉn
- **Y√™u c·∫ßu v·∫≠n chuy·ªÉn**: T·∫°o v√† qu·∫£n l√Ω y√™u c·∫ßu v·∫≠n chuy·ªÉn
- **Ch·ªù chuy·ªÉn giao**: Theo d√µi h√†ng ch·ªù chuy·ªÉn giao
- **ƒê·ªãa ƒëi·ªÉm l∆∞u**: Qu·∫£n l√Ω c√°c ƒë·ªãa ƒëi·ªÉm l∆∞u tr·ªØ
- **T√≠nh to√°n chi ph√≠**: T·ª± ƒë·ªông t√≠nh ph√≠ v·∫≠n chuy·ªÉn d·ª±a tr√™n ph∆∞∆°ng th·ª©c t√≠nh
- **T√≠nh to√°n kho·∫£ng c√°ch**: T√≠ch h·ª£p Google Apps Script v·ªõi Google Maps Services ƒë·ªÉ t√≠nh kho·∫£ng c√°ch th·ª±c t·∫ø
  - T·ª± ƒë·ªông x·ª≠ l√Ω ƒë·ªãa ch·ªâ d√†i v√† k√Ω t·ª± ƒë·∫∑c bi·ªát
  - S·ª≠ d·ª•ng c√¥ng th·ª©c Haversine ƒë·ªÉ t√≠nh kho·∫£ng c√°ch ƒë∆∞·ªùng b·ªô
  - ∆Ø·ªõc t√≠nh th·ªùi gian di chuy·ªÉn d·ª±a tr√™n t·ªëc ƒë·ªô trung b√¨nh

### üì• Qu·∫£n l√Ω Nh·∫≠p h√†ng

- **Nh·∫≠p h√†ng - Qu·ªëc t·∫ø**: Qu·∫£n l√Ω l·ªãch nh·∫≠p h√†ng qu·ªëc t·∫ø
- **Nh·∫≠p h√†ng - Qu·ªëc n·ªôi**: Qu·∫£n l√Ω l·ªãch nh·∫≠p h√†ng n·ªôi ƒë·ªãa
- **L·ªãch nh·∫≠p**: L·ªãch tr√¨nh nh·∫≠p h√†ng t·ªïng h·ª£p

### üì¶ Qu·∫£n l√Ω Kho h√†ng

- **Phi·∫øu chuy·ªÉn kho**: Qu·∫£n l√Ω c√°c phi·∫øu chuy·ªÉn kho v·ªõi giao di·ªán Grid/Table view
- **ƒê∆°n h√†ng**: Theo d√µi ƒë∆°n h√†ng
- **T·ªìn kho**: Qu·∫£n l√Ω h√†ng t·ªìn kho

### üë• Qu·∫£n l√Ω Nh√¢n vi√™n

- **Danh s√°ch nh√¢n vi√™n**: Xem danh s√°ch nh√¢n vi√™n (Grid + Table view)
- **Th√™m/S·ª≠a nh√¢n vi√™n**: Form qu·∫£n l√Ω th√¥ng tin nh√¢n vi√™n
- **Ph√¢n quy·ªÅn**: G√°n vai tr√≤ v√† quy·ªÅn cho nh√¢n vi√™n

### üè¢ Qu·∫£n l√Ω ƒê·ªëi t√°c

- **Nh√† v·∫≠n chuy·ªÉn**: Qu·∫£n l√Ω th√¥ng tin nh√† v·∫≠n chuy·ªÉn
- **ƒê·ªãa ƒëi·ªÉm**: Qu·∫£n l√Ω c√°c ƒë·ªãa ƒëi·ªÉm

### üó∫Ô∏è T√≠nh nƒÉng n√¢ng cao

- **B·∫£n ƒë·ªì**: T√≠ch h·ª£p Google Maps ƒë·ªÉ hi·ªÉn th·ªã ƒë·ªãa ƒëi·ªÉm v√† t√≠nh to√°n tuy·∫øn ƒë∆∞·ªùng
- **Theo d√µi**: H·ªá th·ªëng tracking v√† monitoring
- **Th√¥ng b√°o**: H·ªá th·ªëng notification ƒëa k√™nh (Email, Telegram, In-app)
- **L·ªãch tr√¨nh**: Job scheduling v√† cron jobs
- **B√°o c√°o**: H·ªá th·ªëng logging v√† audit trail

### üîê T√≠nh nƒÉng b·∫£o m·∫≠t n√¢ng cao

- **Session Management**: H·ªá th·ªëng qu·∫£n l√Ω phi√™n ƒëƒÉng nh·∫≠p th√¥ng minh
- **Timeout Warning**: C·∫£nh b√°o tr∆∞·ªõc khi session h·∫øt h·∫°n v·ªõi UI th√¢n thi·ªán
- **Smart Extension**: Gia h·∫°n session c√≥ ƒëi·ªÅu ki·ªán ƒë·ªÉ ƒë·∫£m b·∫£o b·∫£o m·∫≠t
- **Auto Redirect**: T·ª± ƒë·ªông quay v·ªÅ v·ªã tr√≠ c≈© sau khi ƒëƒÉng nh·∫≠p l·∫°i
- **Activity Monitoring**: Theo d√µi ho·∫°t ƒë·ªông ng∆∞·ªùi d√πng ƒë·ªÉ reset session timer
- **Security Guards**: Component b·∫£o v·ªá route v·ªõi authentication v√† authorization

### ‚öôÔ∏è C√†i ƒë·∫∑t h·ªá th·ªëng

- **Ph√¢n quy·ªÅn**: Qu·∫£n l√Ω vai tr√≤, quy·ªÅn v√† ng∆∞·ªùi d√πng
  - Vai tr√≤ (Roles): T·∫°o v√† qu·∫£n l√Ω c√°c vai tr√≤
  - Quy·ªÅn (Permissions): Ph√¢n quy·ªÅn chi ti·∫øt theo resource:action
  - Ng∆∞·ªùi d√πng (Users): Qu·∫£n l√Ω t√†i kho·∫£n ng∆∞·ªùi d√πng
- **T√≠nh to√°n th·ªÉ t√≠ch**: C·∫•u h√¨nh quy t·∫Øc t√≠nh kh·ªëi h√†ng

## üîê H·ªá th·ªëng Authentication & Authorization

### ƒêƒÉng nh·∫≠p

- **Login**: Trang ƒëƒÉng nh·∫≠p v·ªõi email/password
- **Session Management**: Qu·∫£n l√Ω phi√™n ƒëƒÉng nh·∫≠p qua localStorage
- **Auto Redirect**: T·ª± ƒë·ªông chuy·ªÉn h∆∞·ªõng khi ch∆∞a ƒëƒÉng nh·∫≠p

#### Login System

**LoginPage** (`/login`) - **HI·ªÜN T·∫†I**

- Giao di·ªán ƒë·∫πp v√† chuy√™n nghi·ªáp v·ªõi 2 c·ªôt layout
- Logic x·ª≠ l√Ω ·ªïn ƒë·ªãnh v√† ƒë∆°n gi·∫£n
- T√≠nh nƒÉng ƒë·∫ßy ƒë·ªß: Server status, Account lockout, Real-time validation
- Responsive design ho√†n h·∫£o cho m·ªçi thi·∫øt b·ªã
- K·∫øt h·ª£p t·ªët nh·∫•t gi·ªØa UI/UX v√† performance

### Ph√¢n quy·ªÅn (RBAC)

- **Vai tr√≤ (Roles)**: Admin, Manager, Staff, etc.
- **Quy·ªÅn (Permissions)**: Chi ti·∫øt theo resource:action
  - `employees:view/create/update/delete`
  - `transfers:view/create/update/delete`
  - `carriers:view/create/update/delete`
  - `locations:view/create/update/delete`
  - `transport-requests:view/create/update/delete`
  - `inbound-international:view`
  - `inbound-domestic:view`
  - `inbound-schedule:view`
  - `settings:view/update`

### Route Guards

- **Permission-based routing**: ·∫®n/hi·ªán route theo quy·ªÅn
- **Action guards**: ·∫®n/hi·ªán button/action theo quy·ªÅn
- **HOC guards**: `withPermission()`, `requirePermission()`
- **SecurityGuard**: Component b·∫£o v·ªá route v·ªõi authentication

## üóÑÔ∏è C·∫•u tr√∫c Database (Google Sheets)

### Sheets ch√≠nh

1. **Users**: Qu·∫£n l√Ω ng∆∞·ªùi d√πng h·ªá th·ªëng
2. **Roles**: ƒê·ªãnh nghƒ©a c√°c vai tr√≤
3. **RolePermissions**: Ph√¢n quy·ªÅn cho t·ª´ng vai tr√≤
4. **Employees**: Qu·∫£n l√Ω nh√¢n vi√™n
5. **Transfers**: Phi·∫øu chuy·ªÉn kho
6. **Carriers**: Nh√† v·∫≠n chuy·ªÉn
7. **Locations**: ƒê·ªãa ƒëi·ªÉm
8. **TransportRequests**: Y√™u c·∫ßu v·∫≠n chuy·ªÉn
9. **InboundInternational**: L·ªãch nh·∫≠p h√†ng qu·ªëc t·∫ø
10. **InboundDomestic**: L·ªãch nh·∫≠p h√†ng qu·ªëc n·ªôi
11. **InboundSchedule**: L·ªãch nh·∫≠p h√†ng t·ªïng h·ª£p

### üìã ƒê·ªãnh nghƒ©a chi ti·∫øt c√°c c·ªôt - InboundSchedule (54 c·ªôt)

#### üìä T·ªïng quan 54 c·ªôt

| Nh√≥m                    | S·ªë c·ªôt | M√¥ t·∫£                                                      |
| ----------------------- | ------ | ---------------------------------------------------------- |
| **Th√¥ng tin c∆° b·∫£n**    | 12     | ID, ng√†y, PI, nh√† cung c·∫•p, s·∫£n ph·∫©m, s·ªë l∆∞·ª£ng, tr·∫°ng th√°i |
| **Th√¥ng tin b·ªï sung**   | 3      | M·ª•c ƒë√≠ch, gi·ªù nh·∫≠n h√†ng, m√£ PO                             |
| **Th√¥ng tin ƒë√≥ng g√≥i**  | 3      | Lo·∫°i ƒë√≥ng g√≥i, s·ªë l∆∞·ª£ng, m√¥ t·∫£                             |
| **Timeline v·∫≠n chuy·ªÉn** | 18     | 6 m·ªëc th·ªùi gian √ó 3 tr∆∞·ªùng (d·ª± ki·∫øn, th·ª±c t·∫ø, tr·∫°ng th√°i)  |
| **Tr·∫°ng th√°i ch·ª©ng t·ª´** | 15     | 5 m·ªëc th·ªùi gian √ó 3 tr∆∞·ªùng (d·ª± ki·∫øn, th·ª±c t·∫ø, tr·∫°ng th√°i)  |
| **Th√¥ng tin h·ªá th·ªëng**  | 3      | Ghi ch√∫, ng√†y t·∫°o, ng√†y c·∫≠p nh·∫≠t                           |
| **T·ªîNG C·ªòNG**           | **54** | **ƒê·∫ßy ƒë·ªß th√¥ng tin qu·∫£n l√Ω l·ªãch nh·∫≠p h√†ng**                |

#### üî¢ Th√¥ng tin c∆° b·∫£n (12 c·ªôt)

| C·ªôt           | T√™n Vi·ªát h√≥a   | ƒê·ªãnh d·∫°ng | Logic                                                      | M√¥ t·∫£                          |
| ------------- | -------------- | --------- | ---------------------------------------------------------- | ------------------------------ |
| `id`          | M√£ l·ªãch nh·∫≠p   | String    | `INB-{timestamp}`                                          | ID duy nh·∫•t c·ªßa l·ªãch nh·∫≠p h√†ng |
| `date`        | Ng√†y t·∫°o l·ªãch  | Date      | `dd/MM/yyyy`                                               | Ng√†y t·∫°o l·ªãch nh·∫≠p h√†ng        |
| `pi`          | M√£ PI          | String    | Alphanumeric                                               | M√£ Proforma Invoice            |
| `supplier`    | Nh√† cung c·∫•p   | String    | Text                                                       | T√™n nh√† cung c·∫•p               |
| `origin`      | N∆°i xu·∫•t ph√°t  | String    | Location                                                   | ƒê·ªãa ƒëi·ªÉm xu·∫•t ph√°t h√†ng h√≥a    |
| `destination` | N∆°i ƒë·∫øn        | String    | Address                                                    | ƒê·ªãa ƒëi·ªÉm nh·∫≠n h√†ng             |
| `product`     | S·∫£n ph·∫©m       | String    | Text                                                       | T√™n s·∫£n ph·∫©m                   |
| `category`    | Danh m·ª•c       | String    | Text                                                       | Danh m·ª•c s·∫£n ph·∫©m              |
| `quantity`    | S·ªë l∆∞·ª£ng       | Number    | Positive integer                                           | T·ªïng s·ªë l∆∞·ª£ng s·∫£n ph·∫©m         |
| `container`   | S·ªë container   | Number    | Positive integer                                           | S·ªë l∆∞·ª£ng container             |
| `status`      | Tr·∫°ng th√°i     | Enum      | `pending/confirmed/in-transit/arrived/completed/cancelled` | Tr·∫°ng th√°i l·ªãch nh·∫≠p           |
| `carrier`     | Nh√† v·∫≠n chuy·ªÉn | String    | Text                                                       | T√™n nh√† v·∫≠n chuy·ªÉn             |

#### üìù Th√¥ng tin b·ªï sung (3 c·ªôt)

| C·ªôt           | T√™n Vi·ªát h√≥a  | ƒê·ªãnh d·∫°ng | Logic               | M√¥ t·∫£                       |
| ------------- | ------------- | --------- | ------------------- | --------------------------- |
| `purpose`     | M·ª•c ƒë√≠ch      | Enum      | `online/offline`    | M·ª•c ƒë√≠ch s·ª≠ d·ª•ng            |
| `receiveTime` | Gi·ªù nh·∫≠n h√†ng | Time      | `HH:mm`             | Gi·ªù nh·∫≠n h√†ng d·ª± ki·∫øn       |
| `poNumbers`   | M√£ PO         | String    | Semicolon-separated | Danh s√°ch m√£ Purchase Order |

#### üì¶ Th√¥ng tin ƒë√≥ng g√≥i (3 c·ªôt)

| C·ªôt                     | T√™n Vi·ªát h√≥a      | ƒê·ªãnh d·∫°ng | Logic                       | M√¥ t·∫£                                        |
| ----------------------- | ----------------- | --------- | --------------------------- | -------------------------------------------- |
| `packagingTypes`        | Lo·∫°i ƒë√≥ng g√≥i     | String    | Semicolon-separated         | C√°c lo·∫°i ƒë√≥ng g√≥i (1PCS/SET, 2PCS/SET, etc.) |
| `packagingQuantities`   | S·ªë l∆∞·ª£ng ƒë√≥ng g√≥i | String    | Semicolon-separated-numbers | S·ªë l∆∞·ª£ng t∆∞∆°ng ·ª©ng v·ªõi t·ª´ng lo·∫°i ƒë√≥ng g√≥i    |
| `packagingDescriptions` | M√¥ t·∫£ ƒë√≥ng g√≥i    | String    | Semicolon-separated         | M√¥ t·∫£ chi ti·∫øt cho t·ª´ng lo·∫°i ƒë√≥ng g√≥i        |

#### ‚è∞ Timeline v·∫≠n chuy·ªÉn (18 c·ªôt - 6 m·ªëc th·ªùi gian √ó 3 tr∆∞·ªùng)

**6 m·ªëc th·ªùi gian:**

1. **Cargo Ready** - H√†ng s·∫µn s√†ng
2. **ETD** - Estimated Time of Departure (Th·ªùi gian kh·ªüi h√†nh d·ª± ki·∫øn)
3. **ETA** - Estimated Time of Arrival (Th·ªùi gian ƒë·∫øn d·ª± ki·∫øn)
4. **Depart** - Kh·ªüi h√†nh
5. **Arrival Port** - ƒê·∫øn c·∫£ng
6. **Receive** - Nh·∫≠n h√†ng

**M·ªói m·ªëc c√≥ 3 tr∆∞·ªùng:**

| C·ªôt                           | T√™n Vi·ªát h√≥a | ƒê·ªãnh d·∫°ng | Logic                                             | M√¥ t·∫£                          |
| ----------------------------- | ------------ | --------- | ------------------------------------------------- | ------------------------------ |
| `timeline_{milestone}_est`    | Ng√†y d·ª± ki·∫øn | Date      | `dd/MM/yyyy`                                      | Ng√†y d·ª± ki·∫øn cho m·ªëc th·ªùi gian |
| `timeline_{milestone}_act`    | Ng√†y th·ª±c t·∫ø | Date      | `dd/MM/yyyy`                                      | Ng√†y th·ª±c t·∫ø ƒë√£ th·ª±c hi·ªán      |
| `timeline_{milestone}_status` | Tr·∫°ng th√°i   | Enum      | `pending/confirmed/completed/delayed/in-progress` | Tr·∫°ng th√°i c·ªßa m·ªëc th·ªùi gian   |

**V√≠ d·ª• c√°c c·ªôt Timeline:**

- `timeline_cargoReady_est`, `timeline_cargoReady_act`, `timeline_cargoReady_status`
- `timeline_etd_est`, `timeline_etd_act`, `timeline_etd_status`
- `timeline_eta_est`, `timeline_eta_act`, `timeline_eta_status`
- `timeline_depart_est`, `timeline_depart_act`, `timeline_depart_status`
- `timeline_arrivalPort_est`, `timeline_arrivalPort_act`, `timeline_arrivalPort_status`
- `timeline_receive_est`, `timeline_receive_act`, `timeline_receive_status`

#### üìÑ Tr·∫°ng th√°i ch·ª©ng t·ª´ (15 c·ªôt - 5 m·ªëc th·ªùi gian √ó 3 tr∆∞·ªùng)

**5 m·ªëc th·ªùi gian:**

1. **Check Bill** - Ki·ªÉm tra Bill
2. **Check CO** - Ki·ªÉm tra CO (Certificate of Origin)
3. **Send Docs** - G·ª≠i ch·ª©ng t·ª´
4. **Customs** - Th√¥ng quan
5. **Tax** - N·ªôp thu·∫ø

**M·ªói m·ªëc c√≥ 3 tr∆∞·ªùng:**

| C·ªôt                      | T√™n Vi·ªát h√≥a | ƒê·ªãnh d·∫°ng | Logic                                             | M√¥ t·∫£                       |
| ------------------------ | ------------ | --------- | ------------------------------------------------- | --------------------------- |
| `doc_{milestone}_est`    | Ng√†y d·ª± ki·∫øn | Date      | `dd/MM/yyyy`                                      | Ng√†y d·ª± ki·∫øn x·ª≠ l√Ω ch·ª©ng t·ª´ |
| `doc_{milestone}_act`    | Ng√†y th·ª±c t·∫ø | Date      | `dd/MM/yyyy`                                      | Ng√†y th·ª±c t·∫ø ƒë√£ x·ª≠ l√Ω       |
| `doc_{milestone}_status` | Tr·∫°ng th√°i   | Enum      | `pending/confirmed/completed/delayed/in-progress` | Tr·∫°ng th√°i x·ª≠ l√Ω ch·ª©ng t·ª´   |

**V√≠ d·ª• c√°c c·ªôt Document Status:**

- `doc_checkBill_est`, `doc_checkBill_act`, `doc_checkBill_status`
- `doc_checkCO_est`, `doc_checkCO_act`, `doc_checkCO_status`
- `doc_sendDocs_est`, `doc_sendDocs_act`, `doc_sendDocs_status`
- `doc_customs_est`, `doc_customs_act`, `doc_customs_status`
- `doc_tax_est`, `doc_tax_act`, `doc_tax_status`

#### üîß Th√¥ng tin h·ªá th·ªëng (3 c·ªôt)

| C·ªôt         | T√™n Vi·ªát h√≥a  | ƒê·ªãnh d·∫°ng | Logic                              | M√¥ t·∫£                                             |
| ----------- | ------------- | --------- | ---------------------------------- | ------------------------------------------------- |
| `notes`     | Ghi ch√∫       | String    | Text                               | Ghi ch√∫ b·ªï sung v√† m√¥ t·∫£ timeline/document status |
| `createdAt` | Ng√†y t·∫°o      | Timestamp | `HH:mm` ho·∫∑c `dd/MM/yyyy HH:mm:ss` | Th·ªùi gian t·∫°o record                              |
| `updatedAt` | Ng√†y c·∫≠p nh·∫≠t | Timestamp | `dd/MM/yyyy HH:mm:ss`              | Th·ªùi gian c·∫≠p nh·∫≠t cu·ªëi c√πng                      |

#### üîÑ Logic x·ª≠ l√Ω d·ªØ li·ªáu

**1. Timeline Logic:**

- **∆Øu ti√™n hi·ªÉn th·ªã**: `actual` > `estimated` > `created date`
- **Calendar display**: S·ª≠ d·ª•ng ng√†y th·ª±c t·∫ø n·∫øu c√≥, ng∆∞·ª£c l·∫°i d√πng ng√†y d·ª± ki·∫øn
- **Status tracking**: Theo d√µi ti·∫øn ƒë·ªô t·ª´ `pending` ‚Üí `confirmed` ‚Üí `completed`

**2. Document Status Logic:**

- **Workflow**: Check Bill ‚Üí Check CO ‚Üí Send Docs ‚Üí Customs ‚Üí Tax
- **Dependency**: M·ªói b∆∞·ªõc ph·ª• thu·ªôc v√†o b∆∞·ªõc tr∆∞·ªõc ƒë√≥
- **Status mapping**: T∆∞∆°ng t·ª± timeline v·ªõi c√°c tr·∫°ng th√°i t∆∞∆°ng ·ª©ng

**3. Packaging Logic:**

- **Semicolon-separated**: C√°c gi√° tr·ªã ƒë∆∞·ª£c ph√¢n t√°ch b·∫±ng d·∫•u `;`
- **Array mapping**: Frontend convert th√†nh array objects
- **Validation**: ƒê·∫£m b·∫£o s·ªë l∆∞·ª£ng types = quantities = descriptions

**4. Description Storage:**

- **Notes field**: L∆∞u tr·ªØ m√¥ t·∫£ timeline v√† document status
- **Format**: `[Milestone Name]: Description | [Another Milestone]: Description`
- **Parse logic**: Extract descriptions t·ª´ notes field khi load data

**5. Date Format Logic:**

- **Display**: `dd/MM/yyyy` (Vietnamese format)
- **Input**: `yyyy-MM-dd` (HTML date input format)
- **Storage**: `dd/MM/yyyy` trong Google Sheets
- **Conversion**: Auto-convert gi·ªØa c√°c format khi c·∫ßn thi·∫øt

**6. Validation Logic:**

- **Required fields**: id, date, pi, supplier, origin, destination, product, category, quantity, container, status, carrier, purpose, receiveTime, poNumbers
- **Optional fields**: T·∫•t c·∫£ timeline, document status, packaging fields
- **Enum validation**: status, purpose, timeline_status, doc_status
- **Number validation**: quantity, container, packaging quantities
- **Date validation**: T·∫•t c·∫£ date fields ph·∫£i ƒë√∫ng format dd/MM/yyyy

#### üí° V√≠ d·ª• s·ª≠ d·ª•ng

**1. T·∫°o l·ªãch nh·∫≠p h√†ng m·ªõi:**

```json
{
  "id": "INB-1757391900610",
  "date": "09/09/2025",
  "pi": "MG-VMA25-017",
  "supplier": "Eximvina",
  "origin": "NINGBO",
  "destination": "Kho trung t√¢m - l√¥2-5, ƒê∆∞·ªùng CN1, Ph∆∞·ªùng T√¢y Th·∫°nh, Qu·∫≠n T√¢n Ph√∫, Th√†nh ph·ªë H·ªì Ch√≠ Minh",
  "product": "Larita Juden MG0624",
  "category": "Vali",
  "quantity": 3640,
  "container": 2,
  "status": "pending",
  "carrier": "CK",
  "purpose": "online",
  "receiveTime": "08:00",
  "poNumbers": "PO06092025:0025835",
  "packagingTypes": "2PCS/SET",
  "packagingQuantities": "1820",
  "packagingDescriptions": "Test ghi ch√∫ quy c√°ch ƒë√≥ng g√≥i ·∫°",
  "timeline_cargoReady_est": "10/09/2025",
  "timeline_cargoReady_act": "11/09/2025",
  "timeline_cargoReady_status": "completed",
  "timeline_receive_est": "10/09/2025",
  "timeline_receive_act": "",
  "timeline_receive_status": "pending",
  "notes": "Test ghi ch√∫ l·ªãch nh·∫≠p h√†ng"
}
```

**2. C·∫≠p nh·∫≠t timeline:**

```json
{
  "timeline_etd_est": "15/09/2025",
  "timeline_etd_act": "16/09/2025",
  "timeline_etd_status": "completed",
  "timeline_eta_est": "25/09/2025",
  "timeline_eta_act": "26/09/2025",
  "timeline_eta_status": "completed"
}
```

**3. C·∫≠p nh·∫≠t document status:**

```json
{
  "doc_checkBill_est": "01/10/2025",
  "doc_checkBill_act": "02/10/2025",
  "doc_checkBill_status": "completed",
  "doc_customs_est": "05/10/2025",
  "doc_customs_act": "06/10/2025",
  "doc_customs_status": "completed"
}
```

**4. Th√™m m√¥ t·∫£ v√†o notes:**

```
Test ghi ch√∫ l·ªãch nh·∫≠p h√†ng

--- DESCRIPTIONS ---
[Cargo Ready]: H√†ng ƒë√£ s·∫µn s√†ng xu·∫•t kho | [ETD]: T√†u ƒë√£ kh·ªüi h√†nh ƒë√∫ng gi·ªù || [Check Bill]: Bill ƒë√£ ƒë∆∞·ª£c ki·ªÉm tra k·ªπ l∆∞·ª°ng
```

### Schema Users

```typescript
{
  id: string;
  email: string;
  passwordHash: string;
  fullName: string;
  roleId: string;
  status: 'active' | 'inactive';
  createdAt: string;
  updatedAt: string;
}
```

### Schema Roles

```typescript
{
  id: string;
  name: string;
  description: string;
}
```

### Schema RolePermissions

```typescript
{
  roleId: string;
  resource: string;
  action: string;
}
```

## üõ†Ô∏è C√†i ƒë·∫∑t v√† Ch·∫°y

### Y√™u c·∫ßu h·ªá th·ªëng

- Node.js 18+
- npm ho·∫∑c yarn
- Google Sheets API credentials
- Google Maps API key (cho t√≠nh nƒÉng b·∫£n ƒë·ªì)

### C√†i ƒë·∫∑t

```bash
# Clone repository
git clone <repository-url>
cd mia-logistics-manager

# C√†i ƒë·∫∑t dependencies
npm install
cd server && npm install
cd ..

# C·∫•u h√¨nh Google Sheets
cp server/env.example server/.env
# Ch·ªânh s·ª≠a .env v·ªõi SHEET_ID v√† SERVICE_ACCOUNT_KEY
```

### C·∫•u h√¨nh Google Apps Script cho t√≠nh to√°n kho·∫£ng c√°ch

H·ªá th·ªëng s·ª≠ d·ª•ng Google Apps Script ƒë·ªÉ t√≠nh kho·∫£ng c√°ch th·ª±c t·∫ø gi·ªØa c√°c ƒë·ªãa ch·ªâ.

#### 1. T·∫°o Google Apps Script

1. Truy c·∫≠p [Google Apps Script](https://script.google.com/)
2. T·∫°o project m·ªõi
3. Copy code t·ª´ file `google-apps-script/distance-calculator.gs`
4. L∆∞u v√† ƒë·∫∑t t√™n project (v√≠ d·ª•: "MIA Distance Calculator")

#### 2. Deploy Script

1. Click **Deploy** ‚Üí **New deployment**
2. Ch·ªçn type: **Web app**
3. Execute as: **Me**
4. Who has access: **Anyone**
5. Click **Deploy**
6. Copy URL deployment (d·∫°ng: `https://script.google.com/macros/s/.../exec`)

#### 3. C·∫•u h√¨nh Environment

C·∫≠p nh·∫≠t file `.env` v·ªõi URL Google Apps Script:

```bash
# Google Apps Script URL cho t√≠nh to√°n kho·∫£ng c√°ch
VITE_GOOGLE_APPS_SCRIPT_URL=https://script.google.com/macros/s/YOUR_SCRIPT_ID/exec
```

#### 4. Test Script

Test script v·ªõi ƒë·ªãa ch·ªâ m·∫´u:

```bash
curl "https://script.google.com/macros/s/YOUR_SCRIPT_ID/exec?origin=Ho%20Chi%20Minh%20City&destination=Hanoi"
```

K·∫øt qu·∫£ mong ƒë·ª£i:

```json
{
  "success": true,
  "distance": 1479.24,
  "duration": 2958,
  "method": "google_maps_services"
}
```

#### 5. X·ª≠ l√Ω ƒë·ªãa ch·ªâ d√†i

Script t·ª± ƒë·ªông x·ª≠ l√Ω ƒë·ªãa ch·ªâ d√†i b·∫±ng c√°ch:

- R√∫t g·ªçn: "Th√†nh ph·ªë H·ªì Ch√≠ Minh" ‚Üí "HCM"
- Lo·∫°i b·ªè k√Ω t·ª± ƒë·∫∑c bi·ªát
- ∆Øu ti√™n th√¥ng tin quan tr·ªçng (Qu·∫≠n, Ph∆∞·ªùng, s·ªë nh√†)

V√≠ d·ª•:

- Input: "l√¥2-5, ƒê∆∞·ªùng CN1, Ph∆∞·ªùng T√¢y Th·∫°nh, Qu·∫≠n T√¢n Ph√∫, Th√†nh ph·ªë H·ªì Ch√≠ Minh"
- Output: "L2-5 ƒê CN1 P T√¢y Th·∫°nh Q T√¢n Ph√∫ HCM"

### Kh·ªüi ƒë·ªông

```bash
# Terminal 1: Backend
cd server
npm start

# Terminal 2: Frontend
npm run dev
```

### Kh·ªüi t·∫°o d·ªØ li·ªáu

```bash
# T·∫°o sheets v√† d·ªØ li·ªáu m·∫´u
curl -X POST http://localhost:5050/api/auth/init
curl -X POST http://localhost:5050/api/employees/init
```

### T√†i kho·∫£n m·∫∑c ƒë·ªãnh

- **Email**: <admin@mia.vn>
- **Password**: admin@123
- **Role**: Admin (full permissions)

## üì± Giao di·ªán

### Responsive Design

- Mobile-first approach
- Breakpoints: xs, sm, md, lg, xl
- Consistent UI/UX across all views

### Shared Components

- **DataTable**: B·∫£ng d·ªØ li·ªáu v·ªõi sorting, filtering, pagination
- **GridView**: Hi·ªÉn th·ªã d·∫°ng th·∫ª v·ªõi expandable details
- **StatusChip**: Hi·ªÉn th·ªã tr·∫°ng th√°i v·ªõi m√†u s·∫Øc v√† label t√πy ch·ªânh
- **ActionButton**: Button v·ªõi icon v√† label
- **Checkbox**: Checkbox t√πy ch·ªânh
- **FormField**: Field form chu·∫©n h√≥a
- **LoadingState**: Tr·∫°ng th√°i loading
- **EmptyState**: Tr·∫°ng th√°i kh√¥ng c√≥ d·ªØ li·ªáu
- **ErrorBoundary**: X·ª≠ l√Ω l·ªói component

### Navigation Structure

- **Sidebar Navigation**: Menu ƒëi·ªÅu h∆∞·ªõng v·ªõi c√°c nh√≥m ch√≠nh:
  - Dashboard
  - V·∫≠n chuy·ªÉn (V·∫≠n chuy·ªÉn, Ch·ªù chuy·ªÉn giao, ƒê·ªÅ ngh·ªã v·∫≠n chuy·ªÉn, ƒê·ªãa ƒëi·ªÉm l∆∞u)
  - ƒê∆°n h√†ng
  - Kho h√†ng
  - Phi·∫øu chuy·ªÉn kho
  - Nh√† v·∫≠n chuy·ªÉn
  - Nh√¢n vi√™n
  - Theo d√µi
  - Ph√¢n quy·ªÅn h·ªá th·ªëng
  - **Nh·∫≠p h√†ng** (Qu·ªëc t·∫ø, Qu·ªëc n·ªôi, L·ªãch nh·∫≠p)
  - H∆∞·ªõng d·∫´n (Ph√¢n quy·ªÅn)
  - Nh·∫≠t k√Ω ho·∫°t ƒë·ªông
  - C√†i ƒë·∫∑t (B·∫£ng t√≠nh kh·ªëi)

### Theme

- Material-UI v5
- Custom theme v·ªõi brand colors
- Dark/Light mode support
- Consistent typography v√† spacing

## üîß API Endpoints

### Authentication

- `POST /api/auth/login` - ƒêƒÉng nh·∫≠p
- `POST /api/auth/init` - Kh·ªüi t·∫°o auth sheets

### Roles & Permissions

- `GET /api/auth/roles` - L·∫•y danh s√°ch vai tr√≤
- `POST /api/auth/roles` - T·∫°o/s·ª≠a vai tr√≤
- `GET /api/auth/role-permissions` - L·∫•y quy·ªÅn c·ªßa vai tr√≤
- `POST /api/auth/role-permissions` - C·∫≠p nh·∫≠t quy·ªÅn

### Users

- `GET /api/auth/users` - L·∫•y danh s√°ch ng∆∞·ªùi d√πng
- `POST /api/auth/users` - T·∫°o ng∆∞·ªùi d√πng
- `PUT /api/auth/users/:id` - S·ª≠a ng∆∞·ªùi d√πng

### Employees

- `GET /api/employees` - L·∫•y danh s√°ch nh√¢n vi√™n
- `POST /api/employees` - T·∫°o nh√¢n vi√™n
- `PUT /api/employees/:id` - S·ª≠a nh√¢n vi√™n
- `DELETE /api/employees/:id` - X√≥a nh√¢n vi√™n

### Business Data

- `GET /api/transfers` - Phi·∫øu chuy·ªÉn kho
- `GET /api/carriers` - Nh√† v·∫≠n chuy·ªÉn
- `GET /api/locations` - ƒê·ªãa ƒëi·ªÉm
- `GET /api/transport-requests` - Y√™u c·∫ßu v·∫≠n chuy·ªÉn
- `GET /api/inbound/international` - L·ªãch nh·∫≠p h√†ng qu·ªëc t·∫ø
- `GET /api/inbound/domestic` - L·ªãch nh·∫≠p h√†ng qu·ªëc n·ªôi
- `GET /api/inbound/schedule` - L·ªãch nh·∫≠p h√†ng t·ªïng h·ª£p
- `POST /api/inboundinternational` - T·∫°o l·ªãch nh·∫≠p h√†ng m·ªõi (54 c·ªôt)
- `PUT /api/inboundinternational/:id` - C·∫≠p nh·∫≠t l·ªãch nh·∫≠p h√†ng
- `DELETE /api/inboundinternational/:id` - X√≥a l·ªãch nh·∫≠p h√†ng

### Maps & Distance

- `GET /api/maps/distance` - T√≠nh kho·∫£ng c√°ch gi·ªØa c√°c ƒë·ªãa ƒëi·ªÉm
- `GET /api/maps/geocode` - Chuy·ªÉn ƒë·ªïi ƒë·ªãa ch·ªâ th√†nh t·ªça ƒë·ªô

## üìä T√≠nh nƒÉng n√¢ng cao

### Real-time Updates

- Socket.IO integration
- Live notifications
- Real-time data sync

### Notifications

- Email notifications (SendGrid, Nodemailer)
- Telegram bot integration
- In-app notifications
- Push notifications (Web Push API)

### Maps & Location Services

- Google Maps integration
- Distance calculation
- Route optimization
- Geocoding services

### Business Logic

- Transport cost calculation
- Volume calculation algorithms
- Genetic algorithm optimization
- Performance monitoring

### Reporting & Analytics

- Daily/weekly/monthly reports
- Export to Excel/PDF
- Custom report builder
- Audit logging

## üîí B·∫£o m·∫≠t

### Authentication

- bcrypt password hashing
- JWT tokens (planned)
- Session management
- Security context v√† guards

### Authorization

- Role-based access control (RBAC)
- Resource-level permissions
- Action-level permissions
- Route-level protection

### Session Management & Security

- **Session Timeout**: 30 ph√∫t t·ª± ƒë·ªông h·∫øt h·∫°n
- **Warning System**: C·∫£nh b√°o 5 ph√∫t tr∆∞·ªõc khi h·∫øt h·∫°n
- **Smart Extension**: Ch·ªâ cho ph√©p gia h·∫°n session < 20 ph√∫t
- **Auto Redirect**: T·ª± ƒë·ªông quay v·ªÅ v·ªã tr√≠ c≈© sau khi ƒëƒÉng nh·∫≠p l·∫°i
- **Security Guards**: Component b·∫£o v·ªá route v·ªõi authentication
- **Activity Monitoring**: Theo d√µi ho·∫°t ƒë·ªông ng∆∞·ªùi d√πng ƒë·ªÉ reset timer
- **UI Warning**: C·∫£nh b√°o th√¥ng minh v·ªõi m√†u s·∫Øc v√† n√∫t h√†nh ƒë·ªông

### Data Protection

- Input validation (Joi, Zod)
- SQL injection prevention
- XSS protection
- CORS configuration

## üöÄ Deployment

### Production

```bash
# Build frontend
npm run build

# Start production server
cd server
NODE_ENV=production npm start
```

### Environment Variables

```bash
# Backend (.env)
SHEET_ID=your_google_sheet_id
SERVICE_ACCOUNT_KEY=path_to_service_account.json
PORT=5050
NODE_ENV=production

# Frontend (.env)
VITE_API_BASE_URL=http://localhost:5050/api
VITE_GOOGLE_MAPS_API_KEY=your_google_maps_api_key
VITE_GOOGLE_APPS_SCRIPT_URL=https://script.google.com/macros/s/YOUR_SCRIPT_ID/exec
```

## üîß Troubleshooting

### T√≠nh to√°n kho·∫£ng c√°ch kh√¥ng ho·∫°t ƒë·ªông

#### 1. Ki·ªÉm tra Google Apps Script

```bash
# Test script tr·ª±c ti·∫øp
curl "https://script.google.com/macros/s/YOUR_SCRIPT_ID/exec?origin=test&destination=test"
```

**L·ªói th∆∞·ªùng g·∫∑p:**

- `{"success":false,"error":"Missing origin or destination parameter"}` ‚Üí Script ho·∫°t ƒë·ªông, ch·ªâ thi·∫øu parameters
- `{"success":false,"error":"Could not get coordinates from addresses"}` ‚Üí L·ªói Google Maps Services
- `Error 400 (Bad Request)` ‚Üí URL qu√° d√†i, script s·∫Ω t·ª± ƒë·ªông x·ª≠ l√Ω

#### 2. Ki·ªÉm tra Environment Variables

```bash
# Ki·ªÉm tra URL trong .env
grep "VITE_GOOGLE_APPS_SCRIPT_URL" .env
```

#### 3. Ki·ªÉm tra Console Logs

M·ªü Developer Tools ‚Üí Console ƒë·ªÉ xem l·ªói chi ti·∫øt:

- `üîç Starting distance calculation...` ‚Üí Script ƒë∆∞·ª£c g·ªçi
- `üìç Processed origin: ...` ‚Üí ƒê·ªãa ch·ªâ ƒë∆∞·ª£c x·ª≠ l√Ω
- `‚úÖ Real distance calculated: X.XX km` ‚Üí Th√†nh c√¥ng

#### 4. Fallback System

N·∫øu Google Apps Script kh√¥ng ho·∫°t ƒë·ªông, h·ªá th·ªëng s·∫Ω:

- T·ª± ƒë·ªông s·ª≠ d·ª•ng d·ªØ li·ªáu fallback t·ª´ `mapsConfig.ts`
- Hi·ªÉn th·ªã kho·∫£ng c√°ch ∆∞·ªõc t√≠nh cho c√°c route ph·ªï bi·∫øn
- Kh√¥ng l√†m crash ·ª©ng d·ª•ng

## üìù Changelog

### v1.1.0 (2024-09-11)

- ‚úÖ **C·∫£i thi·ªán t√≠nh to√°n kho·∫£ng c√°ch**
  - T√≠ch h·ª£p Google Apps Script v·ªõi Google Maps Services
  - T·ª± ƒë·ªông x·ª≠ l√Ω ƒë·ªãa ch·ªâ d√†i v√† k√Ω t·ª± ƒë·∫∑c bi·ªát
  - H·ªá th·ªëng fallback robust khi Google Apps Script kh√¥ng ho·∫°t ƒë·ªông
  - C·∫£i thi·ªán UI/UX cho b·∫£ng d·ªØ li·ªáu v√† grid view
- ‚úÖ **T·ªëi ∆∞u h√≥a h·ªá th·ªëng**
  - D·ªçn d·∫πp code v√† file t·∫°m th·ªùi
  - C·∫£i thi·ªán error handling v√† logging
  - C·∫≠p nh·∫≠t documentation chi ti·∫øt

### v1.0.0 (2024-08-28)

- ‚úÖ H·ªá th·ªëng authentication ho√†n ch·ªânh
- ‚úÖ UI Ph√¢n quy·ªÅn (Roles/Permissions/Users)
- ‚úÖ Qu·∫£n l√Ω nh√¢n vi√™n (CRUD)
- ‚úÖ Route guards v√† permission-based UI
- ‚úÖ Google Sheets integration
- ‚úÖ Responsive design
- ‚úÖ Shared UI components

### v1.1.0 (2024-09-03)

- ‚úÖ TransportRequestsSheet component v·ªõi giao di·ªán b·∫£ng v√† grid
- ‚úÖ StatusChip component ƒë∆∞·ª£c c·∫£i thi·ªán v·ªõi label prop
- ‚úÖ Google Maps integration cho t√≠nh to√°n kho·∫£ng c√°ch
- ‚úÖ H·ªá th·ªëng notification ƒëa k√™nh
- ‚úÖ Business logic engines (pricing, consolidation, routing)
- ‚úÖ Performance monitoring v√† optimization
- ‚úÖ Error boundaries v√† loading states

### v1.1.1 (2024-09-03)

- ‚úÖ **Session Timeout Warning System**: C·∫£nh b√°o th√¥ng minh 5 ph√∫t tr∆∞·ªõc khi h·∫øt h·∫°n
- ‚úÖ **Smart Session Extension**: Ch·ªâ cho ph√©p gia h·∫°n session < 20 ph√∫t ƒë·ªÉ ƒë·∫£m b·∫£o b·∫£o m·∫≠t
- ‚úÖ **Auto Redirect System**: T·ª± ƒë·ªông quay v·ªÅ v·ªã tr√≠ c≈© sau khi ƒëƒÉng nh·∫≠p l·∫°i
- ‚úÖ **UI Warning Improvements**: Warning ·ªü center top, kh√¥ng che n√∫t ƒëƒÉng xu·∫•t
- ‚úÖ **Security Enhancement**: Ki·ªÉm tra strict session validity, kh√¥ng th·ªÉ gia h·∫°n session c≈©
- ‚úÖ **User Experience**: 2 t√πy ch·ªçn: "Gia h·∫°n phi√™n" ho·∫∑c "ƒêƒÉng nh·∫≠p l·∫°i" t√πy theo tr·∫°ng th√°i

### v1.2.0 (2024-12-19)

- ‚úÖ **Qu·∫£n l√Ω Nh·∫≠p h√†ng**: Th√™m module qu·∫£n l√Ω l·ªãch nh·∫≠p h√†ng v·ªõi 3 m·ª•c con
  - **Nh·∫≠p h√†ng - Qu·ªëc t·∫ø**: Qu·∫£n l√Ω l·ªãch nh·∫≠p h√†ng qu·ªëc t·∫ø
  - **Nh·∫≠p h√†ng - Qu·ªëc n·ªôi**: Qu·∫£n l√Ω l·ªãch nh·∫≠p h√†ng n·ªôi ƒë·ªãa
  - **L·ªãch nh·∫≠p**: L·ªãch tr√¨nh nh·∫≠p h√†ng t·ªïng h·ª£p
- ‚úÖ **Ph√¢n quy·ªÅn m·ªü r·ªông**: Th√™m 3 quy·ªÅn m·ªõi cho module nh·∫≠p h√†ng
  - `inbound-international:view`
  - `inbound-domestic:view`
  - `inbound-schedule:view`
- ‚úÖ **Sidebar Navigation**: C·∫≠p nh·∫≠t c·∫•u tr√∫c menu v·ªõi nh√≥m "Nh·∫≠p h√†ng" v√† c√°c m·ª•c con
- ‚úÖ **Route Protection**: B·∫£o v·ªá routes nh·∫≠p h√†ng v·ªõi permission-based guards
- ‚úÖ **Session Auto-refresh**: T·ª± ƒë·ªông c·∫≠p nh·∫≠t session permissions sau khi thay ƒë·ªïi quy·ªÅn

### v1.3.0 (2025-01-13)

- ‚úÖ **C·∫£i thi·ªán h·ªá th·ªëng Login**: T·∫°o nhi·ªÅu phi√™n b·∫£n login ƒë·ªÉ ph√π h·ª£p v·ªõi nhu c·∫ßu kh√°c nhau
  - **BasicLogin**: Giao di·ªán ƒë∆°n gi·∫£n, logic ·ªïn ƒë·ªãnh
  - **HybridLogin**: Giao di·ªán ƒë·∫πp + logic ƒë∆°n gi·∫£n (KHUY·∫æN NGH·ªä)
  - **AuthLayout**: Giao di·ªán chuy√™n nghi·ªáp v·ªõi ƒë·∫ßy ƒë·ªß t√≠nh nƒÉng
- ‚úÖ **Ph√¢n t√≠ch b·∫£o m·∫≠t**: T·∫°o b√°o c√°o chi ti·∫øt v·ªÅ t√¨nh tr·∫°ng b·∫£o m·∫≠t h·ªá th·ªëng
- ‚úÖ **T·ªëi ∆∞u h√≥a code**: D·ªçn d·∫πp file t·∫°m, c·∫£i thi·ªán c·∫•u tr√∫c code
- ‚úÖ **C·∫≠p nh·∫≠t documentation**: B·ªï sung h∆∞·ªõng d·∫´n s·ª≠ d·ª•ng c√°c phi√™n b·∫£n login

### v1.4.0 (2025-01-13)

- ‚úÖ **ƒê·ªïi t√™n Login System**: HybridLoginPage ‚Üí LoginPage ƒë·ªÉ ng·∫Øn g·ªçn h∆°n
- ‚úÖ **T·ªëi ∆∞u h√≥a c·∫•u tr√∫c**: G·ªôp t·∫•t c·∫£ logic login v√†o 1 component duy nh·∫•t
- ‚úÖ **C·∫£i thi·ªán UI/UX**: Responsive design ho√†n h·∫£o, server status indicator
- ‚úÖ **T√≠nh nƒÉng n√¢ng cao**: Account lockout, real-time validation, remember me
- ‚úÖ **D·ªçn d·∫πp code**: X√≥a c√°c file login c≈©, c·∫≠p nh·∫≠t router v√† documentation

## ü§ù ƒê√≥ng g√≥p

1. Fork repository
2. T·∫°o feature branch
3. Commit changes
4. Push to branch
5. T·∫°o Pull Request

## üìÑ License

MIT License - xem file LICENSE ƒë·ªÉ bi·∫øt th√™m chi ti·∫øt.

## üìû Li√™n h·ªá

- **Email**: <support@mia.vn>
- **Website**: <https://mia.vn>
- **Documentation**: [Wiki](link-to-wiki)

---

¬© 2024 MIA Logistics Manager - H·ªá th·ªëng qu·∫£n l√Ω logistics chuy√™n nghi·ªáp
